C51 COMPILER V9.60.0.0   MAIN                                                              04/18/2024 21:09:17 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "CH552.H"
   2          #include "System.h"
   3          #include "CH552_GPIO.h"
   4          #include "CH552_UART.h"
   5          #include "CH552_TIMER.h"
   6          #include "CH552_PWM.h"
   7                  
   8          char code test_string[] = "Booba";
   9          
  10          //Pins:
  11          // LED = P11
  12          // PWM_1 = P15
  13          // RXD = P30
  14          // TXD = P31
  15          // PWM_2 = P34
  16          
  17          int main()
  18          {
  19   1              UINT8 pwm_clk_div;
  20   1              UINT8 pwm_1_duty;
  21   1              UINT8 pwm_2_duty;
  22   1              UINT8 cmd_count = 0;
  23   1              
  24   1              CfgFsys();      //CH559 clock selection configuration
  25   1              
  26   1              gpio_set_mode(GPIO_MODE_PP, GPIO_PORT_1, GPIO_PIN_1 | GPIO_PIN_5);
  27   1              gpio_set_mode(GPIO_MODE_PP, GPIO_PORT_3, GPIO_PIN_1 | GPIO_PIN_4);
  28   1              gpio_set_mode(GPIO_MODE_INPUT, GPIO_PORT_3, GPIO_PIN_0);
  29   1              
  30   1              uart0_init(TIMER_1, BUAD_RATE, UART_0_P30_P31);
  31   1              pwm_init(PWM_1 | PWM_2, PWM_ACTIVE_HIGH, 0, PWM_1_P15 | PWM_2_P34);
  32   1              pwm_set_duty_cycle(PWM_1 | PWM_2, 0x7F);
  33   1              
  34   1              timer_init(TIMER_0, NULL);
  35   1              timer_set_period(TIMER_0, FREQ_SYS / 1000ul);   //period is 1ms
  36   1              EA = 1; //enable interupts
  37   1              E_DIS = 0;
  38   1              
  39   1              //Blink LED once
  40   1              gpio_clear_pin(GPIO_PORT_1, GPIO_PIN_1);
  41   1              timer_long_delay(TIMER_0, 250);
  42   1              gpio_set_pin(GPIO_PORT_1, GPIO_PIN_1);
  43   1              timer_long_delay(TIMER_0, 250);
  44   1              uart_write_string(UART_0, test_string);
  45   1              
  46   1              while(TRUE)
  47   1              {       
  48   2                      if(uart_bytes_available(UART_0) > 2)
  49   2                      {
  50   3                              pwm_clk_div = uart_read_byte(UART_0);
  51   3                              pwm_1_duty = uart_read_byte(UART_0);
  52   3                              pwm_2_duty = uart_read_byte(UART_0);
  53   3                              pwm_init(PWM_1 | PWM_2, PWM_ACTIVE_HIGH, pwm_clk_div, PWM_1_P15 | PWM_2_P34);
  54   3                              pwm_set_duty_cycle(PWM_1, pwm_1_duty);
C51 COMPILER V9.60.0.0   MAIN                                                              04/18/2024 21:09:17 PAGE 2   

  55   3                              pwm_set_duty_cycle(PWM_2, pwm_2_duty);
  56   3                              
  57   3                              ++cmd_count;
  58   3                              gpio_write_pin(GPIO_PORT_1, GPIO_PIN_1, ~cmd_count & 0x01);
  59   3                      }
  60   2              }
  61   1      }
  62          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    241    ----
   CONSTANT SIZE    =      6    ----
   XDATA SIZE       =   ----       4
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
