C51 COMPILER V9.60.0.0   CH552_GPIO                                                        05/12/2024 09:36:36 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE CH552_GPIO
OBJECT MODULE PLACED IN .\Objects\CH552_GPIO.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE CH552_GPIO.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\L
                    -istings\CH552_GPIO.lst) OBJECT(.\Objects\CH552_GPIO.obj)

line level    source

   1          #include "CH552.H"
   2          #include "CH552_GPIO.h"
   3          
   4          UINT8 p1_last_write = 0xFF;
   5          UINT8 p3_last_write = 0xFF;
   6          
   7          void gpio_set_mode(UINT8 mode, UINT8 port, UINT8 pins)
   8          {
   9   1              UINT8 Pn_MOD_OC;
  10   1              UINT8 Pn_DIR_PU;
  11   1              
  12   1              switch(port)
  13   1              {
  14   2                      case GPIO_PORT_1:
  15   2                              Pn_MOD_OC = P1_MOD_OC;
  16   2                              Pn_DIR_PU = P1_DIR_PU;
  17   2                              break;
  18   2                      case GPIO_PORT_3:
  19   2                              Pn_MOD_OC = P3_MOD_OC;
  20   2                              Pn_DIR_PU = P3_DIR_PU;
  21   2                              break;
  22   2                      default:
  23   2                              return;
  24   2              }
  25   1              
  26   1              switch(mode)
  27   1              {
  28   2                      case GPIO_MODE_INPUT:
  29   2                              //clear bits in Pn_MOD_OC and Pn_DIR_PU
  30   2                              Pn_MOD_OC &= ~pins;
  31   2                              Pn_DIR_PU &= ~pins;
  32   2                              break;
  33   2                      case GPIO_MODE_PP:
  34   2                              //clear bits in Pn_MOD_OC, set bits in Pn_DIR_PU
  35   2                              Pn_MOD_OC &= ~pins;
  36   2                              Pn_DIR_PU |= pins;
  37   2                              break;
  38   2                      case GPIO_MODE_OD:
  39   2                              //set bits in Pn_MOD_OC, clear bits in Pn_DIR_PU
  40   2                              Pn_MOD_OC |= pins;
  41   2                              Pn_DIR_PU &= ~pins;
  42   2                              break;
  43   2                      case GPIO_MODE_OD_PU:
  44   2                              //set bits in Pn_MOD_OC and Pn_DIR_PU
  45   2                              Pn_MOD_OC |= pins;
  46   2                              Pn_DIR_PU |= pins;
  47   2                              break;
  48   2                      default:
  49   2                              return;
  50   2              }
  51   1              
  52   1              switch(port)
  53   1              {
  54   2                      case GPIO_PORT_1:
C51 COMPILER V9.60.0.0   CH552_GPIO                                                        05/12/2024 09:36:36 PAGE 2   

  55   2                              P1_MOD_OC = Pn_MOD_OC;
  56   2                              P1_DIR_PU = Pn_DIR_PU;
  57   2                              break;
  58   2                      case GPIO_PORT_3:
  59   2                              P3_MOD_OC = Pn_MOD_OC;
  60   2                              P3_DIR_PU = Pn_DIR_PU;
  61   2                              break;
  62   2                      default:
  63   2                              return;
  64   2              }
  65   1      }
  66          
  67          #ifdef USE_PORT_FUNCS
              void gpio_write_port(UINT8 port, UINT8 write_data)
              {
                      switch(port)
                      {
                              case GPIO_PORT_1:
                                      P1 = (p1_last_write = write_data);
                                      break;
                              case GPIO_PORT_3:
                                      P3 = (p3_last_write = write_data);
                                      break;
                              default:
                                      return;
                      }
              }
              
              UINT8 gpio_read_port(UINT8 port)
              {
                      switch(port)
                      {
                              case GPIO_PORT_1:
                                      return P1;
                              case GPIO_PORT_3:
                                      return P3;
                              default:
                                      return 0;
                      }
              }
              #endif
  96          
  97          void gpio_write_pin(UINT8 port, UINT8 pin, UINT8 write_data)
  98          {
  99   1              switch(port)
 100   1              {
 101   2                      case GPIO_PORT_1:
 102   2                              P1 = write_data ? (p1_last_write |= pin) : (p1_last_write &= ~pin);
 103   2                              break;
 104   2                      case GPIO_PORT_3:
 105   2                              P3 = write_data ? (p3_last_write |= pin) : (p3_last_write &= ~pin);
 106   2                              break;
 107   2                      default:
 108   2                              return;
 109   2              }
 110   1      }
 111          
 112          UINT8 gpio_read_pin(UINT8 port, UINT8 pin)
 113          {
 114   1              switch(port)
 115   1              {
 116   2                      case GPIO_PORT_1:
C51 COMPILER V9.60.0.0   CH552_GPIO                                                        05/12/2024 09:36:36 PAGE 3   

 117   2                              return (P1 & pin) ? 0x01 : 0x00;
 118   2                      case GPIO_PORT_3:
 119   2                              return (P3 & pin) ? 0x01 : 0x00;
 120   2                      default:
 121   2                              return 0;
 122   2              }
 123   1      }
 124          
 125          void gpio_set_pin(UINT8 port, UINT8 pin)
 126          {
 127   1              switch(port)
 128   1              {
 129   2                      case GPIO_PORT_1:
 130   2                              P1 = (p1_last_write |= pin);
 131   2                              break;
 132   2                      case GPIO_PORT_3:
 133   2                              P3 = (p3_last_write |= pin);
 134   2                              break;
 135   2                      default:
 136   2                              return;
 137   2              }
 138   1      }
 139          
 140          void gpio_clear_pin(UINT8 port, UINT8 pin)
 141          {
 142   1              switch(port)
 143   1              {
 144   2                      case GPIO_PORT_1:
 145   2                              P1 = (p1_last_write &= ~pin);
 146   2                              break;
 147   2                      case GPIO_PORT_3:
 148   2                              P3 = (p3_last_write &= ~pin);
 149   2                              break;
 150   2                      default:
 151   2                              return;
 152   2              }
 153   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    239    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      2    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
